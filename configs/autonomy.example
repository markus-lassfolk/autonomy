# autonomy Configuration Example - Basic Configuration
# Copy this file to /etc/config/autonomy and modify as needed
#
# üéØ PURPOSE: Standard failover configuration for most users
# üè† BEST FOR: Fixed installations, basic multi-WAN setups, simple deployments
#
# üöÄ KEY FEATURES:
# ‚Ä¢ Automatic failover between Starlink, cellular, WiFi, and LAN
# ‚Ä¢ Smart thresholds with predictive failover using machine learning
# ‚Ä¢ Full Starlink API integration with diagnostics and health monitoring
# ‚Ä¢ Pushover notifications for network events and status changes
# ‚Ä¢ Basic metered mode signaling (disabled by default)
# ‚Ä¢ Support for multiple connections of each type
#
# üí° WHEN TO USE:
# ‚úÖ You have a fixed installation (home, office, permanent RV site)
# ‚úÖ You want simple, reliable failover without complexity
# ‚úÖ You don't need WiFi optimization features
# ‚úÖ You're new to autonomy and want to start simple
# ‚úÖ You have stable WiFi environments that don't change frequently
#
# üìö For detailed documentation and WiFi optimization, see: configs/README.md

# =============================================================================
# CORE SYSTEM CONFIGURATION
# =============================================================================
config autonomy 'main'
    # Basic daemon control
    option enable '1'
    option use_mwan3 '1'
    option log_level 'info'
    option log_file ''

    # Timing and intervals
    option poll_interval_ms '1500'
    option history_window_s '600'
    option min_uptime_s '20'
    option cooldown_s '20'

    # Memory and storage
    option retention_hours '24'
    option max_ram_mb '16'

    # Decision making
    option predictive '1'
    option switch_margin '10'
    option data_cap_mode 'balanced'

    # Service endpoints
    option metrics_listener '0'
    option health_listener '1'

    # Performance and Security (system-wide settings)
    option performance_profiling '0'
    option security_auditing '1'
    option profiling_enabled '0'
    option auditing_enabled '1'
    option max_failed_attempts '5'
    option block_duration '300'

# =============================================================================
# NETWORK THRESHOLDS
# =============================================================================
config thresholds 'failover'
    # When to trigger failover
    option loss '5'            # Packet loss percentage
    option latency '1200'      # Latency in milliseconds
    option min_duration_s '10' # Minimum duration before failover

config thresholds 'restore'
    # When to restore/failback
    option loss '1'            # Packet loss percentage
    option latency '800'       # Latency in milliseconds
    option min_duration_s '30' # Minimum duration before restore

# =============================================================================
# STARLINK API CONFIGURATION
# =============================================================================
config starlink 'api'
    option host '192.168.100.1'
    option port '9200'
    option timeout_s '10'
    option grpc_first '1'
    option http_first '0'

# =============================================================================
# MACHINE LEARNING
# =============================================================================
config ml 'settings'
    option enabled '1'
    option model_path '/etc/autonomy/models.json'
    option training '1'
    option prediction '1'

# =============================================================================
# MONITORING ENDPOINTS
# =============================================================================
config monitoring 'mqtt'
    option broker ''
    option topic 'autonomy/status'

# =============================================================================
# NOTIFICATIONS
# =============================================================================
config notifications 'pushover'
    # Pushover service credentials
    option enabled '0'
    option token ''
    option user ''
    option device ''

config notifications 'settings'
    # Notification behavior
    option threshold 'warning'
    option acknowledgment_tracking '1'
    option location_enabled '1'
    option rich_context_enabled '1'
    option cooldown_s '300'
    option max_per_hour '20'

config notifications 'events'
    # Which events to notify about
    option failover '1'
    option failback '1'
    option member_down '1'
    option member_up '0'
    option predictive '1'
    option critical '1'
    option recovery '1'

config notifications 'priorities'
    # Pushover priority levels (-2 to 2)
    option failover '1'
    option failback '0'
    option member_down '1'
    option member_up '-1'
    option predictive '0'
    option critical '2'
    option recovery '0'

# =============================================================================
# METERED MODE INTEGRATION
# =============================================================================
config metered 'settings'
    # Metered connection management
    option enabled '0'
    option warning_threshold '80'
    option critical_threshold '95'
    option hysteresis_margin '5'
    option stability_delay '300'
    option reconnect_method 'gentle'
    option debug '0'

# =============================================================================
# MEMBER CONFIGURATIONS
# =============================================================================

# Starlink member configuration
config member 'starlink_any'
    # Detection mode: auto, disable, force
    option detect 'auto'
    
    # Member class
    option class 'starlink'
    
    # Weight for scoring (0-100)
    option weight '100'
    
    # Minimum uptime for this member (seconds)
    option min_uptime_s '30'
    
    # Cooldown period for this member (seconds)
    option cooldown_s '20'

# Cellular member configuration
config member 'cellular_any'
    option detect 'auto'
    option class 'cellular'
    option weight '80'
    
    # Prefer roaming connections (0=penalize roaming)
    option prefer_roaming '0'
    
    # Mark as metered connection (reduces probing)
    option metered '1'
    
    option min_uptime_s '20'
    option cooldown_s '20'

# WiFi member configuration
config member 'wifi_any'
    option detect 'auto'
    option class 'wifi'
    option weight '60'
    option min_uptime_s '15'
    option cooldown_s '15'

# LAN member configuration
config member 'lan_any'
    option detect 'auto'
    option class 'lan'
    option weight '40'
    option min_uptime_s '10'
    option cooldown_s '10'

# Example: Multiple cellular SIMs
config member 'sim1'
    option detect 'auto'
    option class 'cellular'
    option weight '75'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

config member 'sim2'
    option detect 'auto'
    option class 'cellular'
    option weight '70'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

# Example: WiFi tethering
config member 'wifi_tether'
    option detect 'auto'
    option class 'wifi'
    option weight '50'
    option min_uptime_s '15'
    option cooldown_s '15'

# Example: LAN uplink
config member 'lan_uplink'
    option detect 'auto'
    option class 'lan'
    option weight '30'
    option min_uptime_s '10'
    option cooldown_s '10'

# GPS Configuration
config gps 'settings'
    option enabled '1'
    option source_priority 'rutos,starlink,cellular'
    option movement_threshold_m '500'
    option accuracy_threshold_m '50'
    option staleness_threshold_s '300'
    option collection_interval_s '60'
    option movement_detection '1'
    option location_clustering '1'
    option retry_attempts '3'
    option retry_delay_s '5'
    option google_api_enabled '0'
    option google_api_key ''
    option google_elevation_api_enabled '0'
    
    # GPS API Server Configuration
    option api_server_enabled '0'           # Enable/disable GPS API server
    option api_server_port '8081'           # Port for GPS API server
    option api_server_host 'localhost'      # Host binding (localhost for security)
    option api_server_auth_key ''           # Optional authentication key (empty = anonymous access)
