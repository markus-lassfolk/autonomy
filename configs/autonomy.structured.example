# autonomy Configuration Example - Structured Approach
# Copy this file to /etc/config/autonomy and modify as needed

# =============================================================================
# CORE SYSTEM CONFIGURATION
# =============================================================================
config autonomy 'main'
    # Basic daemon control
    option enable '1'
    option use_mwan3 '1'
    option log_level 'info'
    option log_file ''

    # Timing and intervals
    option poll_interval_ms '1500'
    option history_window_s '600'
    option min_uptime_s '20'
    option cooldown_s '20'

    # Memory and storage
    option retention_hours '24'
    option max_ram_mb '16'

    # Decision making
    option predictive '1'
    option switch_margin '10'
    option data_cap_mode 'balanced'

# =============================================================================
# NETWORK THRESHOLDS
# =============================================================================
config thresholds 'failover'
    # When to fail over to backup
    option fail_threshold_loss '5'          # Percentage
    option fail_threshold_latency '1200'    # Milliseconds
    option fail_min_duration_s '10'         # Seconds

config thresholds 'restore'
    # When to restore to primary
    option restore_threshold_loss '1'       # Percentage
    option restore_threshold_latency '800'  # Milliseconds
    option restore_min_duration_s '30'      # Seconds

# =============================================================================
# STARLINK API CONFIGURATION
# =============================================================================
config starlink 'api'
    option host '192.168.100.1'
    option port '9200'
    option timeout_s '10'
    option grpc_first '1'
    option http_first '0'

# =============================================================================
# MACHINE LEARNING
# =============================================================================
config ml 'settings'
    option enabled '1'
    option model_path '/etc/autonomy/models.json'
    option training '0'
    option prediction '1'

# =============================================================================
# MONITORING AND TELEMETRY
# =============================================================================
config monitoring 'endpoints'
    option metrics_listener '0'
    option health_listener '1'
    option metrics_port '9101'
    option health_port '9102'

config monitoring 'mqtt'
    option broker ''
    option topic 'autonomy/status'
    option enabled '0'

# =============================================================================
# NOTIFICATIONS (PUSHOVER)
# =============================================================================
config notifications 'pushover'
    option enabled '0'
    option token ''
    option user ''
    option device ''

config notifications 'settings'
    # Notification behavior
    option priority_threshold 'warning'
    option acknowledgment_tracking '1'
    option location_enabled '1'
    option rich_context_enabled '1'
    option cooldown_s '300'
    option max_per_hour '20'

config notifications 'events'
    # What to notify about (1=enabled, 0=disabled)
    option on_failover '1'
    option on_failback '1'
    option on_member_down '1'
    option on_member_up '0'
    option on_predictive '1'
    option on_critical '1'
    option on_recovery '1'

config notifications 'priorities'
    # Notification priorities (-2=silent, -1=quiet, 0=normal, 1=high, 2=emergency)
    option failover '1'
    option failback '0'
    option member_down '1'
    option member_up '-1'
    option predictive '0'
    option critical '2'
    option recovery '0'

# =============================================================================
# METERED MODE (WiFi Vendor Element Signaling)
# =============================================================================
config metered 'settings'
    option enabled '0'
    option debug '0'
    option stability_delay '300'
    option client_reconnect_method 'gentle'

config metered 'thresholds'
    option warning_threshold '80'
    option critical_threshold '95'
    option hysteresis_margin '5'

# =============================================================================
# MEMBER CONFIGURATIONS
# =============================================================================

# Starlink member
config member 'starlink_any'
    option detect 'auto'
    option class 'starlink'
    option weight '100'
    option min_uptime_s '30'
    option cooldown_s '20'

# Cellular member
config member 'cellular_any'
    option detect 'auto'
    option class 'cellular'
    option weight '80'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

# WiFi member
config member 'wifi_any'
    option detect 'auto'
    option class 'wifi'
    option weight '60'
    option min_uptime_s '15'
    option cooldown_s '15'

# LAN member
config member 'lan_any'
    option detect 'auto'
    option class 'lan'
    option weight '40'
    option min_uptime_s '10'
    option cooldown_s '10'

# =============================================================================
# EXAMPLE: MULTIPLE CELLULAR SIMS
# =============================================================================
config member 'sim1'
    option detect 'auto'
    option class 'cellular'
    option weight '75'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

config member 'sim2'
    option detect 'auto'
    option class 'cellular'
    option weight '70'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'
