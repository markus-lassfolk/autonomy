# Comprehensive autonomy Configuration - Working UCI Format
# This config uses the correct UCI syntax that avoids parsing errors
# Format: config type (not config package 'name')

# =============================================================================
# CORE SYSTEM CONFIGURATION
# =============================================================================
config main
    # Basic daemon control
    option enable '1'
    option use_mwan3 '1'
    option log_level 'info'
    option log_file ''

    # Timing and intervals
    option poll_interval_ms '1500'
    option history_window_s '600'
    option min_uptime_s '20'
    option cooldown_s '20'

    # Memory and storage
    option retention_hours '24'
    option max_ram_mb '16'

    # Decision making
    option predictive '1'
    option switch_margin '10'
    option data_cap_mode 'balanced'

    # Service endpoints
    option metrics_listener '0'
    option health_listener '1'

    # Performance and Security (system-wide settings)
    option performance_profiling '0'
    option security_auditing '1'
    option profiling_enabled '0'
    option auditing_enabled '1'
    option max_failed_attempts '5'
    option block_duration '300'

# =============================================================================
# NETWORK THRESHOLDS
# =============================================================================
config thresholds 'failover'
    # When to trigger failover
    option loss '5'            # Packet loss percentage
    option latency '1200'      # Latency in milliseconds
    option min_duration_s '10' # Minimum duration before failover

config thresholds 'restore'
    # When to restore/failback
    option loss '1'            # Packet loss percentage
    option latency '800'       # Latency in milliseconds
    option min_duration_s '30' # Minimum duration before restore

# =============================================================================
# STARLINK API CONFIGURATION
# =============================================================================
config starlink 'api'
    option host '192.168.100.1'
    option port '9200'
    option timeout_s '10'
    option grpc_first '1'
    option http_first '0'

# =============================================================================
# MACHINE LEARNING
# =============================================================================
config ml 'settings'
    option enabled '1'
    option model_path '/etc/autonomy/models.json'
    option training '1'
    option prediction '1'

# =============================================================================
# MONITORING ENDPOINTS
# =============================================================================
config monitoring 'mqtt'
    option broker ''
    option topic 'autonomy/status'

# =============================================================================
# NOTIFICATIONS - CONSOLIDATED (Single section to avoid conflicts)
# =============================================================================
config notifications 'settings'
    # Pushover service credentials
    option pushover_enabled '0'
    option pushover_token ''
    option pushover_user ''
    option pushover_device ''
    
    # Notification behavior
    option threshold 'warning'
    option acknowledgment_tracking '1'
    option location_enabled '1'
    option rich_context_enabled '1'
    option cooldown_s '300'
    option max_per_hour '20'
    
    # Which events to notify about
    option event_failover '1'
    option event_failback '1'
    option event_member_down '1'
    option event_member_up '0'
    option event_predictive '1'
    option event_critical '1'
    option event_recovery '1'
    
    # Pushover priority levels (-2 to 2)
    option priority_failover '1'
    option priority_failback '0'
    option priority_member_down '1'
    option priority_member_up '-1'
    option priority_predictive '0'
    option priority_critical '2'
    option priority_recovery '0'

# =============================================================================
# METERED MODE INTEGRATION
# =============================================================================
config metered 'settings'
    # Metered connection management
    option enabled '0'
    option warning_threshold '80'
    option critical_threshold '95'
    option hysteresis_margin '5'
    option stability_delay '300'
    option reconnect_method 'gentle'
    option debug '0'

# =============================================================================
# GPS CONFIGURATION
# =============================================================================
config gps
    option enabled '1'
    option source_priority 'rutos,starlink,cellular'
    option movement_threshold_m '500'
    option accuracy_threshold_m '50'
    option staleness_threshold_s '300'
    option collection_interval_s '30'
    option movement_detection '1'
    option location_clustering '1'
    option retry_attempts '3'
    option retry_delay_s '5'
    option google_api_enabled '1'
    option google_api_key 'YOUR_GOOGLE_API_KEY_HERE'
    option google_elevation_api_enabled '1'

# =============================================================================
# WIFI OPTIMIZATION
# =============================================================================
config wifi 'optimization'
    option enabled '0'
    option movement_threshold '500'
    option gps_accuracy_threshold '50'
    option channel_optimization '1'
    option power_optimization '1'
    option interference_detection '1'

# =============================================================================
# MEMBER CONFIGURATIONS
# =============================================================================

# Starlink member configuration
config member 'starlink_any'
    option detect 'auto'
    option class 'starlink'
    option weight '100'
    option min_uptime_s '30'
    option cooldown_s '20'

# Cellular member configuration
config member 'cellular_any'
    option detect 'auto'
    option class 'cellular'
    option weight '80'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

# WiFi member configuration
config member 'wifi_any'
    option detect 'auto'
    option class 'wifi'
    option weight '60'
    option min_uptime_s '15'
    option cooldown_s '15'

# LAN member configuration
config member 'lan_any'
    option detect 'auto'
    option class 'lan'
    option weight '40'
    option min_uptime_s '10'
    option cooldown_s '10'

# Example: Multiple cellular SIMs
config member 'sim1'
    option detect 'auto'
    option class 'cellular'
    option weight '75'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

config member 'sim2'
    option detect 'auto'
    option class 'cellular'
    option weight '70'
    option prefer_roaming '0'
    option metered '1'
    option min_uptime_s '20'
    option cooldown_s '20'

# Example: WiFi tethering
config member 'wifi_tether'
    option detect 'auto'
    option class 'wifi'
    option weight '50'
    option min_uptime_s '15'
    option cooldown_s '15'

# Example: LAN uplink
config member 'lan_uplink'
    option detect 'auto'
    option class 'lan'
    option weight '30'
    option min_uptime_s '10'
    option cooldown_s '10'
